##### PATENTSVIEW - 0 #####
Error: Slicing error for the schema_linking module
Prompt: Let’s break down the question and map it to the schema step by step.

**Question:**  
Retrieve the following information for U.S. patents filed between January 1, 2014, and February 1, 2014:
- The patent title and abstract.
- The publication date of the patent.
- The number of backward citations for each patent (i.e., the number of patents cited by the current patent before its filing date).
- The number of forward citations for each patent within the first 5 years of its publication (i.e., the number of patents that cited the current patent within 5 years after its publication).
- For each patent, ensure the forward citations are counted only for citations within 5 years after the publication date, and backward citations are counted for citations before the filing date.

---

### 1. "U.S. patents filed between January 1, 2014, and February 1, 2014"

- "filed" → filing date
- Filing date is in `PATENTSVIEW.PATENTSVIEW.PATENT.date` (likely publication date), but actual filing date is in `PATENTSVIEW.PATENTSVIEW.APPLICATION.date` (since `APPLICATION` table has `date` and `patent_id`).
- "U.S. patents" → `PATENTSVIEW.PATENTSVIEW.PATENT.country = 'US'`

**Schema links:**
- `PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.PATENT.country`
- `PATENTSVIEW.PATENTSVIEW.APPLICATION.patent_id = PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.APPLICATION.date`
- `'US'`
- `'2014-01-01'`
- `'2014-02-01'`

---

### 2. "The patent title and abstract"

- `PATENTSVIEW.PATENTSVIEW.PATENT.title`
- `PATENTSVIEW.PATENTSVIEW.PATENT.abstract`

---

### 3. "The publication date of the patent"

- `PATENTSVIEW.PATENTSVIEW.PATENT.date`

---

### 4. "The number of backward citations for each patent (i.e., the number of patents cited by the current patent before its filing date)"

- "backward citations" = patents that the current patent cites
- Citation table: `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION` (has `patent_id` (citing), `citation_id` (cited), `date` (citation publication date))
- Need to count citations where the cited patent's publication date is before the current patent's filing date.

**Schema links:**
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.patent_id = PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.citation_id`
- `PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.APPLICATION.date` (filing date)
- `PATENTSVIEW.PATENTSVIEW.PATENT.date` (publication date of cited patent)
- (For each citation, join `citation_id` to `PATENTSVIEW.PATENTSVIEW.PATENT.id` to get cited patent's publication date)

---

### 5. "The number of forward citations for each patent within the first 5 years of its publication (i.e., the number of patents that cited the current patent within 5 years after its publication)"

- "forward citations" = patents that cite the current patent
- In `USPATENTCITATION`, `citation_id` = current patent, `patent_id` = citing patent
- Need to count citations where the citing patent's publication date is within 5 years after the current patent's publication date.

**Schema links:**
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.citation_id = PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.patent_id`
- `PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.PATENT.date` (publication date of current patent)
- `PATENTSVIEW.PATENTSVIEW.PATENT.date` (publication date of citing patent)
- (For each citation, join `patent_id` to `PATENTSVIEW.PATENTSVIEW.PATENT.id` to get citing patent's publication date)
- 5 years = 1825 days

---

### 6. "For each patent, ensure the forward citations are counted only for citations within 5 years after the publication date, and backward citations are counted for citations before the filing date."

- Already covered in above logic.

---

## **Final Schema Links**

**Schema_links:**
- `PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.PATENT.title`
- `PATENTSVIEW.PATENTSVIEW.PATENT.abstract`
- `PATENTSVIEW.PATENTSVIEW.PATENT.date`
- `PATENTSVIEW.PATENTSVIEW.PATENT.country`
- `PATENTSVIEW.PATENTSVIEW.APPLICATION.patent_id = PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.APPLICATION.date`
- `'US'`
- `'2014-01-01'`
- `'2014-02-01'`
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.patent_id`
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.citation_id`
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.citation_id = PATENTSVIEW.PATENTSVIEW.PATENT.id`
- `PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.patent_id = PATENTSVIEW.PATENTSVIEW.PATENT.id`
- (for backward) `PATENTSVIEW.PATENTSVIEW.PATENT.date < PATENTSVIEW.PATENTSVIEW.APPLICATION.date`
- (for forward) `PATENTSVIEW.PATENTSVIEW.PATENT.date <= citing_patent.date <= PATENTSVIEW.PATENTSVIEW.PATENT.date + 5 years`

---

### **Summary Table**

| Information Needed | Table/Column | Foreign Keys/Links | Cell Values |
|--------------------|--------------|--------------------|-------------|
| Patent title       | PATENT.title |                    |             |
| Patent abstract    | PATENT.abstract |                  |             |
| Publication date   | PATENT.date  |                    |             |
| Filing date        | APPLICATION.date | APPLICATION.patent_id = PATENT.id | |
| Country            | PATENT.country |                    | 'US'        |
| Backward citations | USPATENTCITATION.patent_id = PATENT.id, USPATENTCITATION.citation_id = PATENT.id | | |
| Forward citations  | USPATENTCITATION.citation_id = PATENT.id, USPATENTCITATION.patent_id = PATENT.id | | |
| Date range         | APPLICATION.date |                    | '2014-01-01', '2014-02-01' |
| Date comparisons   | PATENT.date, APPLICATION.date |        | 5 years   |

---

## **Final Answer**

**Schema_links:**
- PATENTSVIEW.PATENTSVIEW.PATENT.id
- PATENTSVIEW.PATENTSVIEW.PATENT.title
- PATENTSVIEW.PATENTSVIEW.PATENT.abstract
- PATENTSVIEW.PATENTSVIEW.PATENT.date
- PATENTSVIEW.PATENTSVIEW.PATENT.country
- PATENTSVIEW.PATENTSVIEW.APPLICATION.patent_id = PATENTSVIEW.PATENTSVIEW.PATENT.id
- PATENTSVIEW.PATENTSVIEW.APPLICATION.date
- 'US'
- '2014-01-01'
- '2014-02-01'
- PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.patent_id
- PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.citation_id
- PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.citation_id = PATENTSVIEW.PATENTSVIEW.PATENT.id
- PATENTSVIEW.PATENTSVIEW.USPATENTCITATION.patent_id = PATENTSVIEW.PATENTSVIEW.PATENT.id
- (for backward) PATENTSVIEW.PATENTSVIEW.PATENT.date < PATENTSVIEW.PATENTSVIEW.APPLICATION.date
- (for forward) PATENTSVIEW.PATENTSVIEW.PATENT.date <= citing_patent.date <= PATENTSVIEW.PATENTSVIEW.PATENT.date + 5 years

**(You may also include the date arithmetic for the 5-year window as a cell value: 5 years, or 1825 days.)**
  ## Question:
    Retrieve the following information for U.S. patents filed between January 1, 2014, and February 1, 2014. The patent title and abstract. The publication date of the patent. The number of backward citations for each patent (i.e., the number of patents cited by the current patent before its filing date). The number of forward citations for each patent within the first 5 years of its publication (i.e., the number of patents that cited the current patent within 5 years after its publication). For each patent, ensure the forward citations are counted only for citations within 5 years after the publication date, and backward citations are counted for citations before the filing date.

  ## Query:
    SELECT
    patent."title",
    patent."abstract",
    app."date" AS publication_date,
    filterData."bkwdCitations",
    filterData."fwrdCitations_5"
FROM
    "PATENTSVIEW"."PATENTSVIEW"."PATENT" AS patent
JOIN
    "PATENTSVIEW"."PATENTSVIEW"."APPLICATION" AS app
    ON app."patent_id" = patent."id"
JOIN (
    SELECT
        DISTINCT cpc."patent_id",
        IFNULL(citation_5."bkwdCitations", 0) AS "bkwdCitations",
        IFNULL(citation_5."fwrdCitations_5", 0) AS "fwrdCitations_5"
    FROM
        "PATENTSVIEW"."PATENTSVIEW"."CPC_CURRENT" AS cpc
    LEFT JOIN (
        SELECT
            b."patent_id",
            b."bkwdCitations",
            f."fwrdCitations_5"
        FROM (
            SELECT 
                cited."citation_id" AS "patent_id",
                IFNULL(COUNT(*), 0) AS "fwrdCitations_5"
            FROM 
                "PATENTSVIEW"."PATENTSVIEW"."USPATENTCITATION" AS cited
            JOIN
                "PATENTSVIEW"."PATENTSVIEW"."APPLICATION" AS apps
                ON cited."citation_id" = apps."patent_id"
            WHERE
                apps."country" = 'US'
                AND cited."date" >= apps."date"
                AND TRY_CAST(cited."date" AS DATE) <= DATEADD(YEAR, 5, TRY_CAST(apps."date" AS DATE)) -- 5-year citation window
            GROUP BY 
                cited."citation_id"
        ) AS f
        JOIN (
            SELECT 
                cited."patent_id",
                IFNULL(COUNT(*), 0) AS "bkwdCitations"
            FROM 
                "PATENTSVIEW"."PATENTSVIEW"."USPATENTCITATION" AS cited
            JOIN
                "PATENTSVIEW"."PATENTSVIEW"."APPLICATION" AS apps
                ON cited."patent_id" = apps."patent_id"
            WHERE
                apps."country" = 'US'
                AND cited."date" < apps."date" -- backward citation count
            GROUP BY 
                cited."patent_id"
        ) AS b
        ON b."patent_id" = f."patent_id"
        WHERE
            b."bkwdCitations" IS NOT NULL
            AND f."fwrdCitations_5" IS NOT NULL
    ) AS citation_5 
    ON cpc."patent_id" = citation_5."patent_id"
    WHERE 
        cpc."subsection_id" IN ('C05', 'C06', 'C07', 'C08', 'C09', 'C10', 'C11', 'C12', 'C13')
        OR cpc."group_id" IN ('A01G', 'A01H', 'A61K', 'A61P', 'A61Q', 'B01F', 'B01J', 'B81B', 'B82B', 'B82Y', 'G01N', 'G16H')
) AS filterData
ON app."patent_id" = filterData."patent_id"
WHERE
    TRY_CAST(app."date" AS DATE) < '2014-02-01' 
    AND TRY_CAST(app."date" AS DATE) >= '2014-01-01';



##### covid19_symptom_search - 0 #####
Error: Slicing error for the schema_linking module
Prompt: Let’s break down the question step by step to find the schema_links:

**Question:**  
"Please calculate the overall percentage change in the average weekly search frequency for the symptom 'Anosmia' across the five New York City counties—Bronx County, Queens County, Kings County, New York County, and Richmond County—by comparing the combined data from January 1, 2019, through December 31, 2019, with the combined data from January 1, 2020, through December 31, 2020."

---

### 1. Identify the relevant table(s):

- The question is about **weekly search frequency** for a symptom at the **county** level.
- The most relevant table is:  
  **bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly**

### 2. Identify the relevant columns:

- **Symptom:** 'Anosmia'  
  → Column: `symptom_anosmia`
- **Geography:** Five NYC counties  
  → Column: `sub_region_2` (county name)
- **State:** All are in New York  
  → Column: `sub_region_1` (should be 'New York')
- **Date range:**  
  → Column: `date`
- **Aggregation:** Need to average weekly values for each year, then compare.

### 3. Identify possible cell values:

- `sub_region_2` values: 'Bronx County', 'Queens County', 'Kings County', 'New York County', 'Richmond County'
- `sub_region_1`: 'New York'
- `date`: between '2019-01-01' and '2019-12-31', and between '2020-01-01' and '2020-12-31'
- `symptom_anosmia`: the metric to average

### 4. Foreign keys:

- There are no explicit foreign keys needed for this query, as all data is in a single table.

---

### 5. Schema_links

**Columns:**
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.sub_region_2
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.sub_region_1
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.date
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.symptom_anosmia

**Cell values:**
- 'Bronx County'
- 'Queens County'
- 'Kings County'
- 'New York County'
- 'Richmond County'
- 'New York'
- '2019-01-01'
- '2019-12-31'
- '2020-01-01'
- '2020-12-31'

**No foreign keys needed.**

---

## Final Answer

**Schema_links:**
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.sub_region_2
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.sub_region_1
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.date
- bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly.symptom_anosmia
- 'Bronx County'
- 'Queens County'
- 'Kings County'
- 'New York County'
- 'Richmond County'
- 'New York'
- '2019-01-01'
- '2019-12-31'
- '2020-01-01'
- '2020-12-31'
  ## Question:
    Please calculate the overall percentage change in the average weekly search frequency for the symptom 'Anosmia' across the five New York City counties—Bronx County, Queens County, Kings County, New York County, and Richmond County—by comparing the combined data from January 1, 2019, through December 31, 2019, with the combined data from January 1, 2020, through December 31, 2020.

  ## Query:
    SELECT
  table_2019.avg_symptom_Anosmia_2019,
  table_2020.avg_symptom_Anosmia_2020,
  ((table_2020.avg_symptom_Anosmia_2020 - table_2019.avg_symptom_Anosmia_2019) / table_2019.avg_symptom_Anosmia_2019) * 100 AS avg_increase
FROM (
  SELECT
    AVG(SAFE_CAST(symptom_Anosmia AS FLOAT64)) AS avg_symptom_Anosmia_2020
  FROM
    `bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly`
  WHERE
    sub_region_1 = "New York"
    AND sub_region_2 IN ("Bronx County", "Queens County", "Kings County", "New York County", "Richmond County")
    AND date >= '2020-01-01'
    AND date < '2021-01-01'
) AS table_2020,
(
  SELECT
    AVG(SAFE_CAST(symptom_Anosmia AS FLOAT64)) AS avg_symptom_Anosmia_2019
  FROM
    `bigquery-public-data.covid19_symptom_search.symptom_search_sub_region_2_weekly`
  WHERE
    sub_region_1 = "New York"
    AND sub_region_2 IN ("Bronx County", "Queens County", "Kings County", "New York County", "Richmond County")
    AND date >= '2019-01-01'
    AND date < '2020-01-01'
) AS table_2019



##### pancancer_atlas_2 - 1 #####
Error: Slicing error for the schema_linking module
Prompt: Let’s break down the question and map the schema links step by step:

**Step 1: Identify the main entities and requirements in the question.**

- **Goal:** Calculate the chi-squared statistic for association between KRAS and TP53 mutations in PAAD patients.
- **Data needed:**
  - Mutation status for KRAS and TP53 genes (per patient)
  - Patient diagnosis (must be PAAD)
  - High-quality mutation annotations
  - Clinical follow-up data (to ensure correct patient matching and possibly for filtering)
  - Unique patient identifiers for matching

**Step 2: Map the question to relevant tables and columns.**

- **Mutation data:**  
  - Table: `isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample`
    - Columns: `ParticipantBarcode`, `Study`, `Hugo_Symbol`, `Variant_Classification`
      - `Hugo_Symbol` = 'KRAS' or 'TP53'
      - `Study` = 'PAAD'
  - **High-quality annotation:**  
    - The table is already "Filtered" and "one_per_tumor_sample", so it is curated for high-quality calls.

- **Clinical follow-up data:**  
  - Table: `isb-cgc-bq.pancancer_atlas.Filtered_clinical_PANCAN_patient_with_followup`
    - Columns: `bcr_patient_barcode`, `acronym` (should be 'PAAD'), etc.

- **Patient matching:**  
  - Use `ParticipantBarcode` (mutation table) and `bcr_patient_barcode` (clinical table).
  - These are the unique patient identifiers.

**Step 3: Identify the schema links (columns, foreign keys, and cell values).**

- **Columns:**
  - `Filtered_MC3_MAF_V5_one_per_tumor_sample.ParticipantBarcode`
  - `Filtered_MC3_MAF_V5_one_per_tumor_sample.Study`
  - `Filtered_MC3_MAF_V5_one_per_tumor_sample.Hugo_Symbol`
  - `Filtered_MC3_MAF_V5_one_per_tumor_sample.Variant_Classification`
  - `Filtered_clinical_PANCAN_patient_with_followup.bcr_patient_barcode`
  - `Filtered_clinical_PANCAN_patient_with_followup.acronym`

- **Foreign keys / Matching:**
  - `Filtered_MC3_MAF_V5_one_per_tumor_sample.ParticipantBarcode = Filtered_clinical_PANCAN_patient_with_followup.bcr_patient_barcode`

- **Cell values:**
  - `Hugo_Symbol` = 'KRAS'
  - `Hugo_Symbol` = 'TP53'
  - `Study` = 'PAAD'
  - `acronym` = 'PAAD'

**Step 4: List the schema links.**

**Schema_links:**
- `Filtered_MC3_MAF_V5_one_per_tumor_sample.ParticipantBarcode`
- `Filtered_MC3_MAF_V5_one_per_tumor_sample.Study`
- `Filtered_MC3_MAF_V5_one_per_tumor_sample.Hugo_Symbol`
- `Filtered_MC3_MAF_V5_one_per_tumor_sample.Variant_Classification`
- `Filtered_clinical_PANCAN_patient_with_followup.bcr_patient_barcode`
- `Filtered_clinical_PANCAN_patient_with_followup.acronym`
- `Filtered_MC3_MAF_V5_one_per_tumor_sample.ParticipantBarcode = Filtered_clinical_PANCAN_patient_with_followup.bcr_patient_barcode`
- `'KRAS'`
- `'TP53'`
- `'PAAD'`

---

**Final Answer:**

Schema_links:
- isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample.ParticipantBarcode
- isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample.Study
- isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample.Hugo_Symbol
- isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample.Variant_Classification
- isb-cgc-bq.pancancer_atlas.Filtered_clinical_PANCAN_patient_with_followup.bcr_patient_barcode
- isb-cgc-bq.pancancer_atlas.Filtered_clinical_PANCAN_patient_with_followup.acronym
- isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample.ParticipantBarcode = isb-cgc-bq.pancancer_atlas.Filtered_clinical_PANCAN_patient_with_followup.bcr_patient_barcode
- 'KRAS'
- 'TP53'
- 'PAAD'

---

**Explanation:**  
These schema links allow you to:
- Select only PAAD patients (using `Study` or `acronym`)
- Identify which patients have KRAS and/or TP53 mutations
- Ensure high-quality, patient-matched data
- Use the correct unique identifiers for matching
- Prepare the contingency table for the chi-squared test

If you need to further restrict to only "pathogenic" or "nonsynonymous" mutations, you may also need to filter on `Variant_Classification` (e.g., missense, nonsense, etc.), but the above covers the core schema links for the question.
  ## Question:
    Using TCGA dataset, calculate the chi-squared statistic to evaluate the association between KRAS and TP53 gene mutations in patients diagnosed with pancreatic adenocarcinoma (PAAD). Incorporate clinical follow-up data and high-quality mutation annotations to accurately determine the frequency of patients with co-occurring KRAS and TP53 mutations compared to those with each mutation occurring independently. Ensure that patient records are meticulously matched based on unique identifiers to maintain data integrity. This analysis aims to identify and quantify potential correlations between KRAS and TP53 genetic alterations within the PAAD patient population.

  ## Query:
    WITH
barcodes AS (
   SELECT bcr_patient_barcode AS ParticipantBarcode
   FROM isb-cgc-bq.pancancer_atlas.Filtered_clinical_PANCAN_patient_with_followup
   WHERE acronym = 'PAAD'
),
table1 AS (
SELECT
   t1.ParticipantBarcode,
   IF(t2.ParticipantBarcode IS NULL, 'NO', 'YES') AS data
FROM
   barcodes AS t1
LEFT JOIN
   (
   SELECT
      ParticipantBarcode AS ParticipantBarcode
   FROM isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample
   WHERE Study = 'PAAD' AND Hugo_Symbol = 'KRAS'
         AND FILTER = 'PASS'
   GROUP BY ParticipantBarcode
   ) AS t2
ON t1.ParticipantBarcode = t2.ParticipantBarcode
),
table2 AS (
SELECT
   t1.ParticipantBarcode,
   IF(t2.ParticipantBarcode IS NULL, 'NO', 'YES') AS data
FROM
   barcodes AS t1
LEFT JOIN
   (
   SELECT
      ParticipantBarcode AS ParticipantBarcode
   FROM isb-cgc-bq.pancancer_atlas.Filtered_MC3_MAF_V5_one_per_tumor_sample
   WHERE Study = 'PAAD' AND Hugo_Symbol = 'TP53'
         AND FILTER = 'PASS'
   GROUP BY ParticipantBarcode
   ) AS t2
ON t1.ParticipantBarcode = t2.ParticipantBarcode
),
summ_table AS (
SELECT
   n1.data AS data1,
   n2.data AS data2,
   COUNT(*) AS Nij
FROM
   table1 AS n1
INNER JOIN
   table2 AS n2
ON
   n1.ParticipantBarcode = n2.ParticipantBarcode
GROUP BY
  data1, data2
),
contingency_table AS (
SELECT
  MAX(IF((data1 = 'YES') AND (data2 = 'YES'), Nij, 0)) AS a,
  MAX(IF((data1 = 'YES') AND (data2 = 'NO'), Nij, 0)) AS b,
  MAX(IF((data1 = 'NO') AND (data2 = 'YES'), Nij, 0)) AS c,
  MAX(IF((data1 = 'NO') AND (data2 = 'NO'), Nij, 0)) AS d,
  (MAX(IF((data1 = 'YES') AND (data2 = 'YES'), Nij, 0)) + MAX(IF((data1 = 'YES') AND (data2 = 'NO'), Nij, 0))) AS row1_total,
  (MAX(IF((data1 = 'NO') AND (data2 = 'YES'), Nij, 0)) + MAX(IF((data1 = 'NO') AND (data2 = 'NO'), Nij, 0))) AS row2_total,
  (MAX(IF((data1 = 'YES') AND (data2 = 'YES'), Nij, 0)) + MAX(IF((data1 = 'NO') AND (data2 = 'YES'), Nij, 0))) AS col1_total,
  (MAX(IF((data1 = 'YES') AND (data2 = 'NO'), Nij, 0)) + MAX(IF((data1 = 'NO') AND (data2 = 'NO'), Nij, 0))) AS col2_total,
  SUM(Nij) AS grand_total
FROM summ_table
)
SELECT
  POWER((a - (row1_total * col1_total) / grand_total), 2) / ((row1_total * col1_total) / grand_total) +
  POWER((b - (row1_total * col2_total) / grand_total), 2) / ((row1_total * col2_total) / grand_total) +
  POWER((c - (row2_total * col1_total) / grand_total), 2) / ((row2_total * col1_total) / grand_total) +
  POWER((d - (row2_total * col2_total) / grand_total), 2) / ((row2_total * col2_total) / grand_total) AS chi_square_statistic
FROM contingency_table
WHERE a IS NOT NULL AND b IS NOT NULL AND c IS NOT NULL AND d IS NOT NULL;



